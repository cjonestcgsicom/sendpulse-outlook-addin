{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/sendpulse_api.ts","webpack:///./src/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","SendPulseClient","id","secret","baseurl","this","clientID","clientSecret","token","baseURL","getToken","callback","parameters","grant_type","client_id","client_secret","makeRequest","getAddressBooks","localStorage","getItem","url","getAddressBookContacts","bookID","addEmailsToAddressBook","emails","data","method","authorized","self","xhr","XMLHttpRequest","open","setRequestHeader","send","JSON","stringify","addEventListener","e","jsonResponse","parse","responseText","console","log","access_token","_sendpulse_api__WEBPACK_IMPORTED_MODULE_0__","$","document","ready","sendPulseToken","sendPulseID","sendPulseSecret","addressBooks","selectedAddressBook","statusCheck","show","hide","val","sendPulseClient_1","getAddressBooksList","success","sendPulseClient","response","passswdStr","idStr","tokenStr","length","removeItem","setItem","showAlert","message","mute","res","list_array","error","error_description","empty","forEach","book","index","str","append","html","click","masterMode","master_mode","toString","book_index","emails_stringified","Array","isArray","getAddressBooksContacts","nextUrl","location","protocol","hostname","port","window","replace","Office","initialize","reason"],"mappings":"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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","class SendPulseClient {\n\n    private clientID: string = '';\n    private clientSecret: string = '';\n    public token: string = '';\n    public baseURL: string = '';\n\n    constructor (id: string, secret: string, baseurl: string) {\n        this.clientID = id;\n        this.clientSecret = secret;\n        this.token ='';\n        this.baseURL = baseurl;\n    }\n\n    getToken(callback) {\n\n        let parameters = {\n            'grant_type': 'client_credentials',\n            'client_id' : this.clientID,\n            'client_secret': this.clientSecret\n        };\n\n        //'https://api.sendpulse.com/oauth/access_token'\n        this.makeRequest(parameters, 'POST', this.baseURL + 'sendpulsetoken', false, callback);\n    }\n\n    getAddressBooks(callback){\n\n        this.token = localStorage.getItem(\"sendPulseToken\");\n        let parameters = {\n            'url': 'listAddressBooks',\n            'token': this.token\n        }\n        //' https://api.sendpulse.com/addressbooks'\n        this.makeRequest(parameters, 'POST', this.baseURL + 'sendpulse', true, callback);\n    }\n\n    getAddressBookContacts(bookID, callback) {\n\n        //'https://api.sendpulse.com/addressbooks/'+ bookID +'/emails';\n        this.token = localStorage.getItem(\"sendPulseToken\");\n        let parameters = {\n            'url': 'getEmailsFromBook',\n            'id' : bookID,\n            'token': this.token\n        }\n\n        this.makeRequest(parameters, 'POST', this.baseURL + 'sendpulse', true, callback);\n    }\n\n    addEmailsToAddressBook(bookID, emails, callback) {\n        this.token = localStorage.getItem(\"sendPulseToken\");\n        let parameters = {\n            'url': 'addEmails',\n            'id' : bookID,\n            'emails': emails,\n            'token': this.token\n        }\n\n        this.makeRequest(parameters, 'POST', this.baseURL + 'sendpulse', true, callback);\n    }\n\n    makeRequest(data, method: string, url: string, authorized: boolean, callback) {\n\n        let self = this;\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(method, url, true);\n        xhr.setRequestHeader('Content-Type', 'application/json');\n        if(authorized){\n            xhr.setRequestHeader('Authorization', 'Bearer ' + this.token);\n        }\n        xhr.send(JSON.stringify(data));\n\n        xhr.addEventListener('load', function(e) {\n            var jsonResponse = JSON.parse(xhr.responseText);\n            console.log(\"Response: \" + JSON.stringify(jsonResponse));\n\n            if(! (jsonResponse.access_token === null ))\n            {\n                console.log(\"Token: \" + jsonResponse.access_token);\n                self.token =  jsonResponse.access_token;\n            }\n            else {\n                console.log(\"Auth error: \" + JSON.stringify(jsonResponse));\n            }\n\n            callback(jsonResponse);\n\n        });\n\n\n    }\n\n}\n\nexport { SendPulseClient };","/*\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n * See LICENSE in the project root for license information.\n */\n\nimport {SendPulseClient} from './sendpulse_api';\n\n\n$(document).ready(() => {\n\n   var sendPulseToken = '';\n   var sendPulseID = '';\n   var sendPulseSecret = '';\n   var baseURL = localStorage.getItem('baseURL');\n   var addressBooks = [];\n   var emails = [];\n   var selectedAddressBook = null;\n\n    if (localStorage.getItem(\"baseURL\") === null) {\n      baseURL = 'https://34.201.190.83:8080/';\n      localStorage.setItem('baseURL', baseURL);\n    }\n\n\n    $('#next').click(next);\n    $('#logout').click(logout);\n    $('#spinner').hide();\n    $(\"#next\").hide();\n    $('#sync_div').hide();\n    $('#login_div').hide();\n    $('#logout').hide();\n\n\n    $('#sideload-msg').hide();\n    $('#app-body').show();\n\n    $('#spAccountButton').click(login);\n    $('.alert').hide();\n\n    $('.close').click((e)=>{\n        $('.alert').hide();\n    });\n    $('[data-dismiss]').click((e)=>{\n        $('.alert').hide();\n    });\n\n// The initialize function must be run each time a new page is loaded\n    Office.initialize = (reason) => {\n        /*\n        $('#sideload-msg').hide();\n        $('#app-body').show();\n\n        $('#spAccountButton').click(login);\n        $('.alert').hide();\n\n        $('.close').click((e)=>{\n            $('.alert').hide();\n        });\n        $('[data-dismiss]').click((e)=>{\n            $('.alert').hide();\n        });\n        */\n    };\n\n    statusCheck();\n\n\n\n\n    function statusCheck()\n    {\n        if (localStorage.getItem(\"sendPulseToken\") === null) {\n            $('#login_div').show();\n            $('#logout').hide();\n            //set stored email an password\n            sendPulseID = localStorage.getItem(\"sendPulseID\");\n            sendPulseSecret = localStorage.getItem(\"sendPulseSecret\");\n            $('#client_id').val(sendPulseID);\n            $('#secret').val(sendPulseSecret);\n        }\n        else {\n            sendPulseToken = localStorage.getItem(\"sendPulseToken\");\n            sendPulseID = localStorage.getItem(\"sendPulseID\");\n            sendPulseSecret = localStorage.getItem(\"sendPulseSecret\");\n            $('#client_id').val(sendPulseID);\n            $('#secret').val(sendPulseSecret);\n\n            let sendPulseClient = new SendPulseClient(sendPulseID, sendPulseSecret, baseURL);\n\n            getAddressBooksList(sendPulseClient, true, (success) => {\n                if(!success)\n                {\n                    getToken(sendPulseClient, (success) => {});\n                }\n                $('#logout').show();\n\n            });\n\n        }\n    }\n\n    function getToken(sendPulseClient: SendPulseClient, callback) {\n\n        $('#spinner').show();\n\n        sendPulseClient.getToken((response) => {\n            $('#spinner').hide();\n\n            if(response.access_token.length){\n                sendPulseToken = response.access_token;\n                $('#login_div').hide();\n                saveSendPulseToken(sendPulseToken);\n                saveSendPulseID(sendPulseID);\n                saveSendPulseSecret(sendPulseSecret);\n                getAddressBooksList(sendPulseClient, false, (success)=> {});\n                $('#logout').show();\n\n                callback(true);\n            }\n            else {\n                callback(false);\n                $('#login_div').show();\n                $('#logout').hide();\n                showAlert(\"Authentication failed! \" + response.message ? response.message : \"\");\n            }\n        });\n    }\n\n    function getAddressBooksList(sendPulseClient: SendPulseClient, mute, callback)\n    {\n        $('#spinner').show();\n        sendPulseClient.getAddressBooks((res)=> {\n            $('#spinner').hide();\n            if(res.error)\n            {\n                if(!mute)\n                {\n                    showAlert(res.message ? res.message : res.error_description);\n                }\n                callback(false);\n            }\n            else\n            {\n                $(\"#next\").show();\n                callback(true);\n                //here make all list visible\n                showAddressBooksList(res)\n            }\n        });\n    }\n\n    function getAddressBooksContacts(sendPulseClient: SendPulseClient, bookID, mute, callback)\n    {\n        $('#spinner').show();\n        sendPulseClient.getAddressBookContacts(bookID,(res)=> {\n            $('#spinner').hide();\n            if(res.error)\n            {\n                if(!mute)\n                {\n                    showAlert(res.message ? res.message : res.error_description);\n                }\n                callback(false);\n            }\n            else\n            {\n                emails = res;\n                saveSendPulseEmails();\n                if(Array.isArray(emails))\n                {\n                    console.log(emails.length + \" emails retrieved from address book\");\n                }\n                callback(true);\n            }\n        });\n    }\n\n\n    function showAddressBooksList(list_array)\n    {\n        addressBooks = list_array;\n\n        $(\"#book_select\").empty();\n        $('#sync_div').show();\n\n        list_array.forEach((book, index) => {\n            var str = '<option ' + (index == 0 ? 'selected' : '') +'  value=\"' + index + '\"' +\n                '>' + book.name + '</option>';\n            $(\"#book_select\").append(str);\n        });\n    }\n\n\n    function logout(){\n        localStorage.removeItem('sendPulseToken');\n        localStorage.removeItem('sendPulseID');\n        localStorage.removeItem('sendPulseSecret');\n        localStorage.removeItem('emailsSelected');\n\n        $('#login_div').show();\n        $('#next').hide();\n        $('#sync_div').hide();\n    }\n\n    function login(){\n\n        sendPulseID =  $('#client_id').val();\n        sendPulseSecret = $('#secret').val();\n\n        let sendPulseClient = new SendPulseClient(sendPulseID, sendPulseSecret, baseURL);\n        getToken(sendPulseClient, (success) => {});\n    }\n\n\n    async function next() {\n\n        //get and save master mode\n        var master_mode = $('input[name=\"inlineRadioOptions\"]:checked').val();\n        console.log(\"Master mode: \" + (master_mode == 1 ? 'SendPulse is Master' : 'Outlook is Master'));\n        saveMasterMode(master_mode);\n\n        //get the selected address-book\n\n        var book_index =  $(\"#book_select\").val();;\n        console.log(\"AddressBooks selected index: \" + book_index );\n\n\n        if(book_index < addressBooks.length)\n        {\n            selectedAddressBook = addressBooks[book_index];\n            saveBookID(selectedAddressBook.id);\n        }\n        else\n        {\n            showAlert(\"You haven'tselected andy address book to synch your contacts with\");\n            return;\n        }\n\n        //get the contacts\n        let sendPulseClient = new SendPulseClient(sendPulseID, sendPulseSecret, baseURL);\n        getAddressBooksContacts(sendPulseClient, selectedAddressBook.id, false, (success) => {\n            if(success)\n            {\n                //go to next page\n                var nextUrl = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '') + '/synchdialog.html';\n                window.location.replace(nextUrl);\n            }\n            else\n            {\n                statusCheck();\n            }\n        });\n\n    }\n\n    //------------ data storing\n    //set new greenRope token\n    function saveSendPulseToken(tokenStr)\n    {\n        sendPulseToken = tokenStr;\n        localStorage.removeItem('sendPulseToken');\n        localStorage.setItem('sendPulseToken', tokenStr);\n    }\n\n    //save email to localStorage\n    function saveSendPulseID(idStr)\n    {\n        sendPulseID = idStr;\n        localStorage.removeItem('sendPulseID');\n        localStorage.setItem('sendPulseID', idStr);\n    }\n\n    //save login to localStorage\n    function saveSendPulseSecret(passswdStr)\n    {\n        sendPulseSecret = passswdStr;\n        localStorage.removeItem('sendPulseSecret');\n        localStorage.setItem('sendPulseSecret', passswdStr);\n    }\n\n    //save emails we got to localStorage\n    function saveSendPulseEmails()\n    {\n        let emails_stringified = JSON.stringify(emails);\n        localStorage.removeItem('emailsSelected');\n        localStorage.setItem('emailsSelected', emails_stringified);\n    }\n\n    function saveMasterMode(masterMode){\n        localStorage.removeItem('masterMode');\n        localStorage.setItem('masterMode', masterMode.toString());\n    }\n\n    function saveBookID(bookID: number)\n    {\n        localStorage.removeItem('bookID');\n        localStorage.setItem('bookID', bookID.toString());\n    }\n\n    //show alert\n    function showAlert(message){\n        $('.alert').show();\n        $(\"#error_text\").html(message);\n    }\n\n\n\n});"],"sourceRoot":""}